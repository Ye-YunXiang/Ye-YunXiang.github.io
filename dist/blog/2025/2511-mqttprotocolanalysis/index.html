<!DOCTYPE html><html lang="en-US" class="astro-37fxchfa" style="--highlightColor: #3fa1fe;"> <head><meta charset="utf-8"><meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport"><meta content="IE=edge" http-equiv="X-UA-Compatible"><title>MQTT协议全面解析 • PoetryCloud</title><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"><link rel="manifest" href="/favicon/site.webmanifest"><link rel="preload" href="/fonts/Satoshi-Variable.ttf" as="font" type="font/ttf" crossorigin><link rel="preload" href="/fonts/Satoshi-VariableItalic.ttf" as="font" type="font/ttf" crossorigin><link rel="canonical" href="https://poetrycld.com/blog/2025/2511-mqttprotocolanalysis"><meta content="MQTT协议全面解析 • PoetryCloud" name="title"><meta content="撕开MQTT协议底裤，分析协议的每 bit 的意义。" name="description"><meta content="PoetryCloud" name="author"><meta content="" name="theme-color"><meta content="article" property="og:type"><meta content="MQTT协议全面解析" property="og:title"><meta content="撕开MQTT协议底裤，分析协议的每 bit 的意义。" property="og:description"><meta content="https://poetrycld.com/blog/2025/2511-mqttprotocolanalysis" property="og:url"><meta content="PoetryCloud" property="og:site_name"><meta content="en_US" property="og:locale"><meta content="https://poetrycld.com/_astro/2512-MqttProtocolAnalysis-banner.BU97JBLf.jpg" property="og:image"><meta content="1200" property="og:image:width"><meta content="630" property="og:image:height"><meta content="PoetryCloud" property="article:author"><meta content="2025-11-27T23:30:00.000Z" property="article:published_time"><meta content="summary_large_image" property="twitter:card"><meta content="https://poetrycld.com/blog/2025/2511-mqttprotocolanalysis" property="twitter:url"><meta content="MQTT协议全面解析" property="twitter:title"><meta content="撕开MQTT协议底裤，分析协议的每 bit 的意义。" property="twitter:description"><meta content="https://poetrycld.com/_astro/2512-MqttProtocolAnalysis-banner.BU97JBLf.jpg" property="twitter:image"><link href="/sitemap-index.xml" rel="sitemap"><link rel="alternate" type="application/rss+xml" title="PoetryCloud" href="https://poetrycld.com/rss.xml"><meta content="Astro v5.16.0" name="generator"><link rel="stylesheet" href="/styles/global.css"><script type="module">console.log("%c Astro Theme Pure %c https://github.com/cworld1/astro-theme-pure/","color:#fff;background:linear-gradient(90deg,#448bff,#44e9ff);padding:5px 0;","color:#000;background:linear-gradient(90deg,#44e9ff,#ffffff);padding:5px 10px 5px 0px;");</script><script>
  function simpleSetTheme() {
    let theme = localStorage.getItem('theme')
    // If undefined or 'system', get from system
    if (!theme || theme === 'system') {
      theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
    }
    document.documentElement.classList.toggle('dark', theme === 'dark')
    document
      .querySelector('meta[name="theme-color"]')
      ?.setAttribute('content', theme === 'dark' ? '#0B0B10' : '#FCFCFD')
  }
  simpleSetTheme()
  document.addEventListener('astro:page-load', () => simpleSetTheme())
</script><script type="module" src="/_astro/ThemeProvider.astro_astro_type_script_index_0_lang.CW1wQWPM.js"></script><link rel="stylesheet" href="/_astro/index.BTZ-y30j.css">
<link rel="stylesheet" href="/_astro/_id_.qVo7mKyw.css">
<link rel="stylesheet" href="/_astro/_id_.BsL8bFF2.css">
<link rel="stylesheet" href="/_astro/waline.CU5niAxJ.css">
<style>#waline:where(.astro-y3qunytq){--waline-font-size: 16px;--waline-white: hsl(var(--background) / var(--un-bg-opacity, 1));--waline-light-grey: #999;--waline-dark-grey: #666;--waline-theme-color: hsl(var(--foreground) / var(--un-text-opacity, 1));--waline-active-color: hsl(var(--primary) / var(--un-text-opacity, 1));--waline-color: hsl(var(--muted-foreground) / var(--un-text-opacity, 1));--waline-bg-color: hsl(var(--muted) / var(--un-bg-opacity, 1));--waline-bg-color-light: hsl(var(--input) / var(--un-text-opacity, 1));--waline-bg-color-hover: #f0f0f0;--waline-border-color: hsl(var(--border) / var(--un-border-opacity, 1));--waline-disable-bg-color: #f8f8f8;--waline-disable-color: #bbb;--waline-code-bg-color: #282c34;--waline-bq-color: #f0f0f0;--waline-avatar-size: 3.25rem;--waline-m-avatar-size: calc(var(--waline-avatar-size) * 9 / 13);--waline-badge-color: hsl(var(--border) / var(--un-border-opacity, 1));--waline-badge-font-size: .775em;--waline-info-bg-color: var(--waline-bg-color-light);--waline-info-color: var(--waline-color);--waline-info-font-size: .625em;--waline-border: 1px solid var(--waline-border-color);--waline-avatar-radius: 50%;--waline-box-shadow: none}#waline:where(.astro-y3qunytq) .wl-content,.wl-text,.wl-comment-text,.wl-item,.wl-card-item,a{max-width:100%}#waline:where(.astro-y3qunytq) .wl-meta,.wl-content,.wl-text,.wl-comment-text{word-wrap:break-word;word-break:break-word;overflow-wrap:anywhere}#waline:where(.astro-y3qunytq) a{display:inline-block}#waline:where(.astro-y3qunytq) .wl-item,.wl-card-item{overflow:hidden}#waline:where(.astro-y3qunytq) .wl-reaction-title,.wl-reaction-text{display:none}#waline:where(.astro-y3qunytq) .wl-reaction{overflow:visible;margin-bottom:.5em}#waline:where(.astro-y3qunytq) .wl-reaction-img{width:auto;display:flex;height:35px;align-items:center;column-gap:.4rem}#waline:where(.astro-y3qunytq) .wl-reaction-votes{position:inherit;top:inherit;min-width:inherit;inset-inline-end:inherit;display:flex;font-weight:400;border:none;background:none;color:inherit;padding:.2rem .4rem;border-radius:6px}#waline:where(.astro-y3qunytq) .wl-reaction-loading{position:inherit;top:inherit;min-width:inherit}#waline:where(.astro-y3qunytq) .wl-reaction-item.active .wl-reaction-votes{background:var(--waline-theme-color);color:var(--waline-bg-color)}#waline:where(.astro-y3qunytq) .wl-reaction-votes:after{margin-left:.25em;content:"Like(s)";display:inline-block;clear:both;border:0}#waline:where(.astro-y3qunytq) .wl-reaction img{filter:invert(25%)}.dark #waline:where(.astro-y3qunytq) .wl-reaction img{filter:invert(75%)}
@media(min-width:769px){#sidebar-shade:where(.astro-scuu7fyy){display:none!important}}@media(max-width:769px){aside:where(.astro-scuu7fyy).show{display:block!important;opacity:1}@keyframes fade-in-side{0%{transform:translate(50%);opacity:0}to{transform:translate(0);opacity:1}}@keyframes fade-in{0%{opacity:0}to{opacity:1}}aside:where(.astro-scuu7fyy){animation:.3s fade-in-side!important;animation-fill-mode:forwards;right:0;top:0!important;height:100vh!important;min-width:40vw!important;max-width:75vw!important;border-top-right-radius:0!important;border-bottom-right-radius:0!important;padding-top:1.5rem!important;padding-bottom:1.5rem!important}#sidebar-shade:where(.astro-scuu7fyy){animation:.3s fade-in}}@media(max-width:640px){aside:where(.astro-scuu7fyy){min-width:55vw!important}}
@keyframes pulsate{0%{opacity:1}50%{opacity:.4}to{opacity:1}}.loading:where(.astro-fkh43kdv) .load-block:where(.astro-fkh43kdv){color:transparent;border-radius:calc(var(--radius) - 3px);background-color:hsl(var(--primary-foreground) / var(--un-bg-opacity, 1));animation:pulsate 2s infinite linear;user-select:none}.loading:where(.astro-fkh43kdv) .load-block:where(.astro-fkh43kdv):nth-child(2){animation-delay:1s}.no-license:where(.astro-fkh43kdv){opacity:.5}:where(.astro-fkh43kdv):not(.loading) #gh-avatar:where(.astro-fkh43kdv){background-color:hsl(var(--primary-foreground) / var(--un-bg-opacity))}
header-component:where(.astro-zgz2aqyx){transition:padding .3s,transform .3s,margin-inline .3s,border .15s,background-color .15s;&.not-top{--un-border-opacity: 1;border-color:hsl(var(--border) / var(--un-border-opacity));--un-bg-opacity: 1;background-color:hsl(var(--background) / var(--un-bg-opacity));padding-left:.375rem;padding-right:.375rem;box-shadow:#fff 0 0,#18181b14 0 0 0 1px,#27272a14 0 10px 15px -3px,#27272a14 0 4px 6px -4px}&[data-show=false]:not(.expanded){transform:translateY(-5rem)}}@media(min-width:800px){header-component:where(.astro-zgz2aqyx).not-top{margin-inline:8%}}.dark header-component:where(.astro-zgz2aqyx).not-top{background-color:hsl(var(--muted) / var(--un-bg-opacity))}@media(max-width:640px){#headerExpandContent:where(.astro-zgz2aqyx){grid-template-rows:0fr;transition:opacity .3s,padding .3s,border-color .15s,grid-template-rows .3s}.expanded:where(.astro-zgz2aqyx) #headerExpandContent:where(.astro-zgz2aqyx){grid-template-rows:1fr}.expanded:where(.astro-zgz2aqyx).not-top #headerExpandContent:where(.astro-zgz2aqyx){box-shadow:#fff 0 0,#18181b14 0 0 0 1px,#27272a14 0 10px 15px -3px,#27272a14 0 4px 6px -4px}header-component:where(.astro-zgz2aqyx) #headerExpandContent:where(.astro-zgz2aqyx):after{box-sizing:content-box;content:"";position:absolute;inset-inline:calc(-1rem - 1px);bottom:0;top:-5rem;z-index:-1;transition:.3s;visibility:hidden;opacity:0;border-bottom:1px solid transparent}header-component:where(.astro-zgz2aqyx):not(.not-top) #headerExpandContent:where(.astro-zgz2aqyx):after{visibility:visible;bottom:-1rem;opacity:1;background-color:hsl(var(--muted) / var(--un-bg-opacity, 1));border-bottom-color:hsl(var(--border) / var(--un-border-opacity, 1))}}#toggleDarkMode:where(.astro-zgz2aqyx){&[data-theme=dark]{.system:where(.astro-zgz2aqyx){display:none}.dark:where(.astro-zgz2aqyx){display:block}}&[data-theme=light]{.system:where(.astro-zgz2aqyx){display:none}.light{display:block}}}@font-face{font-family:Satoshi;src:url(/fonts/Satoshi-Variable.ttf) format("truetype");font-style:normal;font-display:swap}@font-face{font-family:Satoshi;src:url(/fonts/Satoshi-VariableItalic.ttf) format("truetype");font-style:italic;font-display:swap}html{font-family:Satoshi,sans-serif}:root{--background: 210 33% 99%;--foreground: 240 10% 3.9%;--card: 0 0% 100%;--card-foreground: 240 10% 3.9%;--popover: 0 0% 100%;--popover-foreground: 240 10% 3.9%;--primary: 200 29% 45%;--primary-foreground: 0 0% 92.5%;--secondary: 240 4.8% 95.9%;--secondary-foreground: 240 5.9% 10%;--muted: 240 4.8% 95%;--muted-foreground: 240 3.8% 28.1%;--accent: 240 4.8% 95.9%;--accent-foreground: 240 5.9% 10%;--destructive: 0 72.22% 50.59%;--destructive-foreground: 0 0% 98%;--border: 240 5.9% 88%;--input: 240 5.9% 90%;--ring: 240 5.9% 10%;--radius: .5rem}.dark{--background: 240 20.54% 5.2%;--foreground: 0 0% 98%;--card: 240 10% 3.9%;--card-foreground: 0 0% 98%;--popover: 240 10% 3.9%;--popover-foreground: 0 0% 98%;--primary: 195 95% 85%;--primary-foreground: 240 3.7% 15.9%;--secondary: 240 3.7% 15.9%;--secondary-foreground: 0 0% 98%;--muted: 240 5.9% 12%;--muted-foreground: 240 5% 74.9%;--accent: 240 3.7% 15.9%;--accent-foreground: 0 0% 98%;--destructive: 0 62.8% 30.6%;--destructive-foreground: 0 0% 98%;--border: 240 3.7% 19.9%;--input: 240 3.7% 15.9%;--ring: 240 4.9% 83.9%}:root{--un-default-border-color: hsl(var(--border) / 1)}html.dark{color-scheme:dark}a{transition:color .2s ease;&:hover{color:hsl(var(--primary) / var(--un-text-opacity, 1))}}.highlight{color:var(--highlightColor, hsl(var(--primary) / var(--un-text-opacity)))!important}.highlight-bg{background-color:var( --highlightColor, hsl(var(--primary) / var(--un-text-opacity)) )!important}
:where([data-astro-image]){object-fit:var(--fit);object-position:var(--pos);height:auto}:where([data-astro-image=full-width]){width:100%}:where([data-astro-image=constrained]){max-width:100%}
.link-preview:where(.astro-fov3225h) img:where(.astro-fov3225h),.link-preview:where(.astro-fov3225h) video:where(.astro-fov3225h){aspect-ratio:1200 / 630;width:100%;height:auto;object-fit:cover}
.medium-zoom-overlay{position:fixed;inset:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1;z-index:999}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform;z-index:999}
starlight-tabs:where(.astro-m7f3nve7){display:block}.tablist-wrapper:where(.astro-m7f3nve7){overflow-x:auto}:where(.astro-m7f3nve7)[role=tablist]{display:flex;list-style:none;border-bottom:2px solid hsl(var(--border) / var(--un-border-opacity, 1));padding:0}.tab:where(.astro-m7f3nve7){margin-bottom:-2px}.tab:where(.astro-m7f3nve7)>:where(.astro-m7f3nve7)[role=tab]{display:flex;align-items:center;gap:.5rem;padding:.2rem 1.25rem;text-decoration:none;border-bottom:2px solid hsl(var(--border) / var(--un-border-opacity, 1));color:hsl(var(--foreground) / var(--un-text-opacity, 1));outline-offset:-.1875rem;overflow-wrap:initial}.tab:where(.astro-m7f3nve7) :where(.astro-m7f3nve7)[role=tab][aria-selected=true]{color:hsl(var(--primary) / var(--un-text-opacity, 1));border-color:hsl(var(--primary) / var(--un-text-opacity, 1));font-weight:600}.tablist-wrapper:where(.astro-m7f3nve7)~[role=tabpanel]{margin-top:1rem}
.aside:where(.astro-kdde4gve)>.aside-container:where(.astro-kdde4gve){--un-bg-opacity: .07;&.aside-tip{--primary: 234 60% 60%}&.aside-caution{--primary: 41 90% 50%}&.aside-danger{--primary: 339 90% 60%}.aside-content{>:first-child{margin-top:0}>:last-child{margin-bottom:0}}}
.mdx-repl:where(.astro-le7uvupp){background:linear-gradient(135deg,hsl(var(--primary) / .05),hsl(var(--muted) / .2))}.mdx-repl-container:where(.astro-le7uvupp)>*{width:var(--width)}.mdx-repl-container:where(.astro-le7uvupp)>*:first-child{margin-top:0}.mdx-repl-container:where(.astro-le7uvupp)>*:last-child{margin-bottom:0}.mdx-repl:where(.astro-le7uvupp) .astro-code{margin:0;border-radius:0}.mdx-repl:where(.astro-le7uvupp) div[role=tabpanel]{margin-top:0}
svg:where(.astro-hn7k2gay){color:var(--sl-icon-color);font-size:var(--sl-icon-size, 1em);width:1.5em;height:1.5em}
.expand-content:where(.astro-5lfx4xea){grid-template-rows:0fr}.expanded:where(.astro-5lfx4xea) .expand-content:where(.astro-5lfx4xea){grid-template-rows:1fr}
.sl-steps{--bullet-size: 1.75rem ;--bullet-margin: .375rem;list-style:none!important;counter-reset:steps-counter var(--sl-steps-start, 0);padding-inline-start:0!important}.sl-steps>li{counter-increment:steps-counter;position:relative;padding-inline-start:calc(var(--bullet-size) + 1rem);padding-bottom:1px;min-height:calc(var(--bullet-size) + var(--bullet-margin))}.sl-steps>li+li{margin-top:0}.sl-steps>li:before{content:counter(steps-counter);position:absolute;top:0;inset-inline-start:0;width:var(--bullet-size);height:var(--bullet-size);line-height:var(--bullet-size);font-size:.8125rem;font-weight:600;text-align:center;color:hsl(var(--foreground) / var(--un-text-opacity, 1));background-color:hsl(var(--primary-foreground) / var(--un-bg-opacity, 1));border-radius:99rem;box-shadow:inset 0 0 0 1px hsl(var(--border) / var(--un-border-opacity, 1))}.sl-steps>li:after{--guide-width: 1px;content:"";position:absolute;top:calc(var(--bullet-size) + var(--bullet-margin));bottom:var(--bullet-margin);inset-inline-start:calc((var(--bullet-size) - var(--guide-width)) / 2);width:var(--guide-width);background-color:hsl(var(--border) / var(--un-border-opacity, 1))}.sl-steps>li>:first-child{--lh: 1.75em ;--shift-y: calc(.5 * (var(--bullet-size) - var(--lh)));margin-top:0;transform:translateY(var(--shift-y));margin-bottom:var(--shift-y);color:hsl(var(--foreground) / var(--un-text-opacity, 1))}.sl-steps>li>:first-child:where(h1,h2,h3,h4,h5,h6){--lh: 1.2em }
.spoiler:where(.astro-fya6xpir):not(:hover) *{color:inherit!important;background-color:transparent!important}
</style><script type="module" src="/_astro/page.D1uwR3nK.js"></script></head> <body class="flex justify-center bg-background text-foreground astro-37fxchfa" class="astro-scuu7fyy" style="--highlightColor: #3fa1fe;"> <div id="highlight-gradient" class="pointer-events-none absolute start-0 top-0 z-0 h-screen w-full opacity-25 astro-37fxchfa" style="background-image:linear-gradient(#3fa1fe,transparent); --highlightColor: #3fa1fe;"></div> <div class="w-full max-w-[70rem] px-4 sm:px-7 lg:px-10 min-h-[100dvh] flex flex-col justify-between astro-37fxchfa" style="--highlightColor: #3fa1fe;"> <header-component class="group sticky top-4 z-50 max-md:z-30 mb-12 flex items-center justify-between rounded-xl border border-transparent max-sm:py-1 sm:rounded-2xl astro-zgz2aqyx"> <a class="z-30 text-xl font-semibold group-[.not-top]:ms-2 sm:group-[.not-top]:ms-3 astro-zgz2aqyx" style="transition:margin-inline 0.3s" href="/" aria-label="Brand">PoetryCloud</a> <div class="flex items-center gap-x-2 astro-zgz2aqyx">  <div id="headerExpandContent" class="end-0 start-0 top-12 grid border border-transparent group-[.not-top]:rounded-xl group-[.expanded]:opacity-100 dark:group-[.expanded.not-top]:bg-muted max-sm:absolute max-sm:opacity-0 max-sm:group-[.not-top]:border-border max-sm:group-[.expanded.not-top]:bg-background max-sm:group-[.not-top]:px-4 max-sm:group-[.not-top]:py-2 sm:grid-rows-1 astro-zgz2aqyx"> <div class="flex flex-col items-center justify-center overflow-hidden sm:flex-row astro-zgz2aqyx"> <a href="/blog" class="w-full flex-none grow py-2 text-right font-medium transition-none hover:text-primary sm:w-fit sm:px-3 astro-zgz2aqyx" aria-label="Nav menu item"> Blog </a><a href="/archives" class="w-full flex-none grow py-2 text-right font-medium transition-none hover:text-primary sm:w-fit sm:px-3 astro-zgz2aqyx" aria-label="Nav menu item"> Archives </a><a href="/about" class="w-full flex-none grow py-2 text-right font-medium transition-none hover:text-primary sm:w-fit sm:px-3 astro-zgz2aqyx" aria-label="Nav menu item"> About </a> <div class="flex w-full grow flex-row justify-end gap-x-3 sm:w-fit sm:gap-x-5 astro-zgz2aqyx"> <a class="px-1 py-2 transition-none sm:px-2 astro-zgz2aqyx" href="/search" title="Search"> <span class="sr-only astro-zgz2aqyx">Search</span> <svg aria-hidden="true" class="size-5 astro-zgz2aqyx astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M5 10a5 5 0 1 1 10 0a5 5 0 0 1-10 0m5-7a7 7 0 1 0 4.192 12.606l5.1 5.101a1 1 0 0 0 1.415-1.414l-5.1-5.1A7 7 0 0 0 10 3"/></g></svg>  </a> </div> </div> </div>  <div class="z-30 flex gap-x-4 group-[.not-top]:gap-x-2 astro-zgz2aqyx" style="transition:gap 0.3s"> <button id="toggleDarkMode" class="group/dark box-content size-5 rounded-md border p-1.5 transition-colors hover:bg-border sm:group-[.not-top]:rounded-xl astro-zgz2aqyx"> <span class="sr-only astro-zgz2aqyx">Dark Theme</span> <svg aria-hidden="true" class="system size-5 group-hover/dark:text-primary astro-zgz2aqyx astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" fill-rule="nonzero" d="M19 3a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2h-4v1h1a1 1 0 1 1 0 2H8a1 1 0 1 1 0-2h1v-1H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Zm-6 15h-2v1h2zm6-13H5v11h14z"/></g></svg>  <svg aria-hidden="true" class="light hidden size-5 group-hover/dark:text-primary astro-zgz2aqyx astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M12 19a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0v-1a1 1 0 0 1 1-1m6.364-2.05l.707.707a1 1 0 0 1-1.414 1.414l-.707-.707a1 1 0 0 1 1.414-1.414m-12.728 0a1 1 0 0 1 1.497 1.32l-.083.094l-.707.707a1 1 0 0 1-1.497-1.32l.083-.094zM12 6a6 6 0 1 1 0 12a6 6 0 0 1 0-12m0 2a4 4 0 1 0 0 8a4 4 0 0 0 0-8m-8 3a1 1 0 0 1 .117 1.993L4 13H3a1 1 0 0 1-.117-1.993L3 11zm17 0a1 1 0 1 1 0 2h-1a1 1 0 1 1 0-2zM4.929 4.929a1 1 0 0 1 1.32-.083l.094.083l.707.707a1 1 0 0 1-1.32 1.497l-.094-.083l-.707-.707a1 1 0 0 1 0-1.414m14.142 0a1 1 0 0 1 0 1.414l-.707.707a1 1 0 1 1-1.414-1.414l.707-.707a1 1 0 0 1 1.414 0M12 2a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0V3a1 1 0 0 1 1-1"/></g></svg>  <svg aria-hidden="true" class="dark hidden size-5 group-hover/dark:text-primary astro-zgz2aqyx astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M12.477 4.546a1.01 1.01 0 0 1 1.097-1.409A9 9 0 0 1 12 21c-4.434 0-8.118-3.206-8.863-7.426a1.01 1.01 0 0 1 1.409-1.097a6 6 0 0 0 7.931-7.931m2.404 1.072a8 8 0 0 1-9.263 9.263A7.002 7.002 0 0 0 19 12.001a7 7 0 0 0-4.12-6.383ZM5.565 7.716l.064.14a3.26 3.26 0 0 0 1.237 1.363l.1.059a.068.068 0 0 1 0 .118l-.1.058a3.26 3.26 0 0 0-1.237 1.364l-.064.14a.071.071 0 0 1-.13 0l-.064-.14a3.26 3.26 0 0 0-1.237-1.364l-.1-.058a.068.068 0 0 1 0-.118l.1-.059A3.26 3.26 0 0 0 5.37 7.855l.064-.14a.071.071 0 0 1 .13 0Zm2.832-4.859c.04-.09.166-.09.206 0l.102.222a5.2 5.2 0 0 0 1.97 2.172l.157.092a.108.108 0 0 1 0 .189l-.158.092a5.2 5.2 0 0 0-2.07 2.394a.113.113 0 0 1-.207 0l-.102-.222a5.2 5.2 0 0 0-1.97-2.172l-.158-.092a.108.108 0 0 1 0-.189l.158-.092a5.2 5.2 0 0 0 1.97-2.172z"/></g></svg>  </button> <button id="toggleMenu" class="rounded-md border p-1.5 transition-colors hover:bg-border sm:hidden sm:group-[.not-top]:rounded-xl astro-zgz2aqyx"> <span class="sr-only astro-zgz2aqyx">Menu</span> <svg aria-hidden="true" class="size-5 astro-zgz2aqyx astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M20 18a1 1 0 0 1 .117 1.993L20 20H4a1 1 0 0 1-.117-1.993L4 18zm0-7a1 1 0 1 1 0 2H4a1 1 0 1 1 0-2zm0-7a1 1 0 1 1 0 2H4a1 1 0 0 1 0-2z"/></g></svg>  </button> </div> </div> </header-component>  <script>
  const toggleDarkModeElement = document.getElementById('toggleDarkMode')
  if (toggleDarkModeElement) {
    toggleDarkModeElement.dataset.theme = localStorage.getItem('theme') || 'system'
  }
</script> <script type="module" src="/_astro/Header.astro_astro_type_script_index_0_lang.52pHqpSo.js"></script>  <div class="flex-1 w-full astro-37fxchfa" style="--highlightColor: #3fa1fe;">  <a class="group inline-flex items-center gap-x-1 rounded-lg bg-muted border px-2 py-1 text-sm text-muted-foreground transition-all hover:bg-primary-foreground no-underline astro-scuu7fyy" href="/blog" data-astro-prefetch="true">  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="stroke-muted-foreground group-hover:stroke-primary"> <line x1="19" y1="12" x2="5" y2="12" class="translate-x-3 scale-x-0 transition-all duration-300 ease-in-out group-hover:translate-x-0 group-hover:scale-x-100"></line> <polyline points="12 19 5 12 12 5" class="translate-x-1 transition-all duration-300 ease-in-out group-hover:translate-x-0"></polyline> </svg>   <p class="my-0">Back</p>     </a> <main class="mt-6 items-start gap-x-10 md:flex astro-scuu7fyy">  <aside class="animate top-20 min-w-48 basis-60 overflow-y-scroll max-md:hidden z-40 fixed md:sticky md:order-2 lg:shrink-0 max-md:border max-md:px-4 max-md:py-3 max-md:bg-muted max-md:rounded-xl astro-scuu7fyy" style="height:calc(100vh - 7rem);" id="sidebar"> <toc-heading class=" astro-mmcgqrmu" slot="sidebar"> <h2 class="font-semibold astro-mmcgqrmu">TABLE OF CONTENTS</h2> <ul class="mt-4 text-card-foreground astro-mmcgqrmu"> <li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: 访问流程" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted" href="#访问流程">访问流程</a> </div> <ul> <li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: MQTT 连接服务器" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#mqtt-连接服务器">MQTT 连接服务器</a> </div>  </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: MQTT 订阅主题" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#mqtt-订阅主题">MQTT 订阅主题</a> </div>  </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: MQTT 发布消息" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#mqtt-发布消息">MQTT 发布消息</a> </div> <ul> <li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: QoS0 的 PUBLISH 控制报文" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#qos0-的-publish-控制报文">QoS0 的 PUBLISH 控制报文</a> </div>  </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: QoS1 的 PUBLISH 控制报文" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#qos1-的-publish-控制报文">QoS1 的 PUBLISH 控制报文</a> </div>  </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: QoS2 的 PUBLISH 控制报文" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#qos2-的-publish-控制报文">QoS2 的 PUBLISH 控制报文</a> </div>  </li> </ul> </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: 取消订阅" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#取消订阅">取消订阅</a> </div>  </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: 断开连接" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#断开连接">断开连接</a> </div>  </li> </ul> </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: 报文案例" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted" href="#报文案例">报文案例</a> </div> <ul> <li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: CONNECT-连接服务端" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#connect-连接服务端">CONNECT-连接服务端</a> </div>  </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: PINGREQ-心跳请求" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#pingreq-心跳请求">PINGREQ-心跳请求</a> </div>  </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: DISCONNECT-断开连接" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#disconnect-断开连接">DISCONNECT-断开连接</a> </div>  </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: SUBSCRIBE_订阅主题" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#subscribe_订阅主题">SUBSCRIBE_订阅主题</a> </div>  </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: UNSUBSCRIBE_取消订阅" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#unsubscribe_取消订阅">UNSUBSCRIBE_取消订阅</a> </div>  </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: PUBLISH_数据上报" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#publish_数据上报">PUBLISH_数据上报</a> </div>  </li> </ul> </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: 阿里云" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted" href="#阿里云">阿里云</a> </div> <ul> <li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: 参数（以阿里手册为主）" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#参数以阿里手册为主">参数（以阿里手册为主）</a> </div>  </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: 自己编写一波" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#自己编写一波">自己编写一波</a> </div>  </li><li> <div class="relative"> <span class="absolute top-[5%] w-[2px] rounded transition-colors duration-300 [&.highlight-bg]:bg-primary [&.is-read]:bg-input"></span> <a aria-label="Scroll to section: 上传格式" class="toc-item line-clamp-2 px-3 py-1 ms-2 text-foreground/75 transition-all hover:text-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.is-read]:text-input [&#38;.highlight-bg-translucent]:bg-muted ps-7" href="#上传格式">上传格式</a> </div>  </li> </ul> </li> </ul> </toc-heading> <script type="module">class l extends HTMLElement{constructor(){super(),this.headings=[],this.tocLinks=[],this.headingProgress={},this.updatePositionAndStyle=()=>{const t=window.innerHeight,r=window.scrollY-(document.querySelector("#content")?.offsetTop||0),o=(document.querySelector("#content")?.offsetHeight||0)+127;this.headings.forEach((e,n)=>{const h=this.headings[n+1]?.offsetTop||o,s=[e.offsetTop-r,h-r-e.offsetHeight],i=(t-s[0])/(s[1]-s[0]);this.headingProgress[e.id]={inView:s[0]<t&&s[1]>0,progress:Math.max(0,Math.min(1,i))}}),this.tocLinks.forEach(({element:e,progressBar:n,slug:h},s)=>{const{inView:i,progress:g}=this.headingProgress[h];this.headingProgress[h]&&(e.classList.toggle("highlight",i),e.classList.toggle("highlight-bg-translucent",i),e.classList.toggle("rounded-t-2xl",i&&(s==0||!this.headingProgress[this.tocLinks[s-1]?.slug].inView)),e.classList.toggle("rounded-b-2xl",i&&(s==this.tocLinks.length-1||!this.headingProgress[this.tocLinks[s+1]?.slug].inView)),n.classList.toggle("is-read",!i&&g==1),n.classList.toggle("highlight-bg",i),n.style.setProperty("height",`${g*90}%`))})},this.headings=Array.from(document.querySelectorAll("article h2, article h3, article h4, article h5, article h6")),this.tocLinks=Array.from(this.querySelectorAll('a[href^="#"]')).map(t=>({element:t,progressBar:t.previousElementSibling,slug:(t.getAttribute("href")||"").substring(1)}))}connectedCallback(){this.tocLinks.forEach(t=>{t.element.addEventListener("click",r=>{r.preventDefault();const o=this.headings.find(e=>e.id===t.slug);o?(history.pushState(null,o.textContent||"",t.element.getAttribute("href")),o.scrollIntoView({behavior:"smooth"})):console.warn(`No heading found for slug: ${t.slug}`)})}),setInterval(this.updatePositionAndStyle,100),window.addEventListener("scroll",this.updatePositionAndStyle)}}customElements.define("toc-heading",l);</script>  </aside> <div id="sidebar-shade" class="fixed top-0 start-0 w-full h-full astro-scuu7fyy" style="display:none;background-color:#00000091;z-index:31"></div> <article class="min-w-0 grow astro-scuu7fyy">  <div id="content-header" class="animate astro-scuu7fyy"> <div class="hero-image relative mb-6 astro-qr7qsrsa"><img src="/_astro/2512-MqttProtocolAnalysis-banner.BU97JBLf_Z2nUVhI.webp" alt="MQTT协议全面解析" fetchpriority="high" loading="eager" color="#3fa1fe" decoding="async" width="1081" height="700" class="cover-image relative z-10 h-auto w-full max-w-[65ch] rounded-2xl object-contain astro-qr7qsrsa"><img src="/_astro/2512-MqttProtocolAnalysis-banner.BU97JBLf_Z2nUVhI.webp" alt="Blur image" fetchpriority="high" loading="eager" id="blurImage" color="#3fa1fe" decoding="async" width="1081" height="700" class="absolute end-0 top-4 z-0 mt-0 h-full max-w-[65ch] rounded-3xl opacity-60 transition-opacity duration-300 astro-qr7qsrsa"></div><div class="article-info max-lg:mx-auto astro-qr7qsrsa"> <div class="flex flex-wrap gap-x-4 gap-y-2 text-xs leading-6 text-muted-foreground astro-qr7qsrsa">  <div class="flex items-center gap-1 astro-qr7qsrsa"> <svg aria-hidden="true" class="size-5 astro-qr7qsrsa astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M16 3a1 1 0 0 1 1 1v1h2a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2V4a1 1 0 0 1 2 0v1h6V4a1 1 0 0 1 1-1M8 7H5v2h14V7h-3zm-3 4v8h14v-8zm2 2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H8a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2zm3-2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H12a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2zm3-2a1 1 0 0 1 1-1h.01a1 1 0 1 1 0 2H16a1 1 0 0 1-1-1m1 2a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2z"/></g></svg>  <span class="text-muted-foreground font-mono font-sans astro-qr7qsrsa"> <time datetime="2025-11-27T23:30:00.000Z"> Nov 28, 2025 </time> </span>  </div>  <div class="flex items-center gap-1 astro-qr7qsrsa"> <svg aria-hidden="true" class="size-5 astro-qr7qsrsa astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2m0 2a8 8 0 1 0 0 16a8 8 0 0 0 0-16m0 2a1 1 0 0 1 .993.883L13 7v4.586l2.707 2.707a1 1 0 0 1-1.32 1.497l-.094-.083l-3-3a1 1 0 0 1-.284-.576L11 12V7a1 1 0 0 1 1-1"/></g></svg>  15 min read </div> <span class="flex items-center gap-1 astro-qr7qsrsa"> <svg aria-hidden="true" class="size-5 astro-qr7qsrsa astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2m1.482 14.94a18 18 0 0 1-2.964 0q.14.596.31 1.102c.251.755.53 1.293.79 1.622c.127.162.23.248.3.29l.051.028l.03.008l.032-.008l.051-.027a1.2 1.2 0 0 0 .3-.29c.26-.33.539-.868.79-1.623q.17-.506.31-1.102m-8.675-1.435a8.03 8.03 0 0 0 4.441 4.01a11 11 0 0 1-.318-.84a16 16 0 0 1-.52-2.033a18 18 0 0 1-3.603-1.137m14.387 0c-1.145.5-2.351.883-3.605 1.137a16 16 0 0 1-.52 2.034q-.144.437-.318.838a8.03 8.03 0 0 0 4.443-4.01Zm-5.218-4.634a15 15 0 0 1-3.952 0a26 26 0 0 0 .141 4.025a16.2 16.2 0 0 0 3.67 0A25 25 0 0 0 14 12q0-.576-.024-1.13ZM4.568 9.032a8 8 0 0 0-.52 3.856a16 16 0 0 0 4.067 1.637a28 28 0 0 1-.074-4.053a15 15 0 0 1-3.473-1.44m14.864 0a15 15 0 0 1-3.473 1.44a28 28 0 0 1-.074 4.053a16 16 0 0 0 4.066-1.637a8 8 0 0 0-.52-3.855Zm-7.416-5.02l-.011-.002l-.02.003l-.038.015a1.2 1.2 0 0 0-.33.307c-.26.33-.538.868-.79 1.622c-.27.808-.488 1.8-.633 2.919a13 13 0 0 0 3.612 0c-.145-1.12-.364-2.111-.633-2.919c-.252-.754-.53-1.293-.79-1.622a1.2 1.2 0 0 0-.3-.29l-.067-.032Zm-2.768.474a8 8 0 0 0-3.71 2.797c.843.484 1.746.876 2.695 1.163c.16-1.164.397-2.223.697-3.122q.145-.438.318-.838m5.504 0q.172.4.318.838c.3.9.537 1.958.697 3.122a13 13 0 0 0 2.695-1.163a8 8 0 0 0-3.71-2.797"/></g></svg>  中文 </span> <span class="flex items-center gap-1 astro-qr7qsrsa"> <svg aria-hidden="true" class="size-5 astro-qr7qsrsa astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M10.124 3.008a1 1 0 0 1 .868 1.116L10.508 8h3.984l.516-4.124a1 1 0 1 1 1.984.248L16.508 8H20a1 1 0 1 1 0 2h-3.742l-.5 4H19.5a1 1 0 1 1 0 2h-3.992l-.516 4.124a1 1 0 1 1-1.984-.248L13.492 16H9.508l-.516 4.124a1 1 0 1 1-1.984-.248L7.492 16H4.5a1 1 0 1 1 0-2h3.242l.5-4H5a1 1 0 0 1 0-2h3.492l.516-4.124a1 1 0 0 1 1.116-.868M13.742 14l.5-4h-3.984l-.5 4z"/></g></svg>  <div class="astro-qr7qsrsa"> <a aria-label="View more blogs with the tag 协议" class="hover:underline hover:underline-offset-4 astro-qr7qsrsa" data-pagefind-filter="tag" href="/tags/协议"> 协议 </a> / </div><div class="astro-qr7qsrsa"> <a aria-label="View more blogs with the tag mqtt" class="hover:underline hover:underline-offset-4 astro-qr7qsrsa" data-pagefind-filter="tag" href="/tags/mqtt"> mqtt </a>  </div> </span> </div> <h1 class="mt-4 text-2xl font-medium sm:mb-2 sm:mt-6 sm:text-3xl astro-qr7qsrsa"> MQTT协议全面解析 </h1> <div class="mt-3 italic astro-qr7qsrsa"> <blockquote class="text-sm text-muted-foreground astro-qr7qsrsa"><q class="astro-qr7qsrsa">撕开MQTT协议底裤，分析协议的每 bit 的意义。</q></blockquote> <div class="text-base text-sm text-muted-foreground mt-1"> <span class="waline-pageview-count" data-path="/blog/2025/2511-mqttprotocolanalysis"></span> views
 | <a href="#waline"> <span class="waline-comment-count" data-path="/blog/2025/2511-mqttprotocolanalysis"></span> comments
</a>  </div>  </div> </div>  <div class="mt-4 w-1/2 border-t max-md:mx-auto sm:mt-6 sm:w-1/3 astro-qr7qsrsa"></div> <script type="module">const o=window.innerHeight,s=o/9,i=o*2/9,l=o*3/9,e=document.getElementById("blurImage");e&&window.addEventListener("scroll",()=>{const t=window.scrollY;t>=l?e.style.opacity="0.15":t>=i?e.style.opacity="0.3":t>=s&&(e.style.opacity="0.45")});</script>  </div>  <div id="content" class="max-w-none animate mt-8 md:min-w-[45ch] overflow-x-hidden prose text-base astro-scuu7fyy">   <p>深度挖掘一下 MQTT。
中文文档：<a href="https://mcxiaoke.gitbooks.io/mqtt-cn/content/" rel="nofollow noopener noreferrer" target="_blank">https://mcxiaoke.gitbooks.io/mqtt-cn/content/<span style="user-select:none"> ↗</span></a>
CSDN：<a href="https://blog.csdn.net/qq_39785798/article/details/80765716" rel="nofollow noopener noreferrer" target="_blank">https://blog.csdn.net/qq_39785798/article/details/80765716<span style="user-select:none"> ↗</span></a></p>
<p>消息队列遥测传输协议，是基于发布/订阅模式的“轻量级”通讯协议，该协议构建与 TCP/IP。
优点：可以以极少的代码和有限的带宽，为连接远程设备提供实时可靠的消息。作为一种低开销、低带宽占用的即时通讯协议，主要在物联网、小型设备、移动设备上应用。</p>
<blockquote>
<p>根据中文文档协议说明，通过 AT 透传把相对应协议命令转化为 ASCII 码/16 进制在发送给服务端。
请求数据包解析：<a href="https://blog.csdn.net/qq_29933439/article/details/91350987" rel="nofollow noopener noreferrer" target="_blank">https://blog.csdn.net/qq_29933439/article/details/91350987<span style="user-select:none"> ↗</span></a></p>
</blockquote>
<h2 id="访问流程">访问流程<a class="anchor" href="#访问流程">#</a></h2>
<p><a href="https://blog.csdn.net/jiejiemcu/article/details/106737995" rel="nofollow noopener noreferrer" target="_blank">https://blog.csdn.net/jiejiemcu/article/details/106737995<span style="user-select:none"> ↗</span></a></p>
<blockquote>
<p>首先 TCP 连接到服务器端口。</p>
</blockquote>
<blockquote>
<p><img alt="image.png" class="zoomable" loading="lazy" decoding="async" fetchpriority="auto" width="714" height="680" src="/_astro/net-img-1691545397623-daa5357f-4a6f-4510-8f3b-c4709ec74900-20231029145727-qr3rlvh.CIl1Wp68_Z272HYi.webp" ></p>
</blockquote>
<p>以下发送的报文均为 16 进制 ASCII 码。</p>
<h3 id="mqtt-连接服务器">MQTT 连接服务器<a class="anchor" href="#mqtt-连接服务器">#</a></h3>
<ol>
<li>
<p><code>客户端</code> CONNECT 连接请求。</p>
<ol>
<li>第一个报文必须是 CONNECT 报文，且只能一次，否则违规。</li>
</ol>
</li>
<li>
<p><code>服务端</code> CONNACK 确认连接请求。</p>
<ol>
<li>服务端返回的应答码。</li>
</ol>
</li>
<li>
<p>中间是正常的数据交互。</p>
</li>
<li>
<p><code>客户端</code> PINGREQ 心跳请求。</p>
<ol>
<li>隔一段时间（1 分钟左右）要有心跳请求，否则断开。</li>
</ol>
</li>
<li>
<p><code>服务端</code> PINGRESP 心跳响应。</p>
</li>
</ol>
<p><img alt="image.png" class="zoomable" loading="lazy" decoding="async" fetchpriority="auto" width="533" height="390" src="/_astro/net-img-1691545659877-c6d8cec0-340e-43ad-a4b0-67bef59bfc02-20231029145727-buhxx9k.CKOqaOnw_ZK04Tg.webp" ></p>
<h3 id="mqtt-订阅主题">MQTT 订阅主题<a class="anchor" href="#mqtt-订阅主题">#</a></h3>
<ol>
<li>
<p><code>订阅者</code> SUBSCRIBE 订阅主题。</p>
<ol>
<li>
<p>用于创建一个或多个订阅。</p>
</li>
<li>
<p>支持通配符，指定了最大 QoS 等级，有固定、可变报头和有效载荷。</p>
<ol>
<li>这里的有效载荷包含了主题过滤列表，标识客户端想要订阅的主题，必须是 UTF-8 字符串。</li>
</ol>
</li>
</ol>
</li>
<li>
<p><code>服务器</code> SUBACK 订阅确认。</p>
<ol>
<li>必须和等待确认的 SUBSCRIBE 有相同的报文标识符。</li>
</ol>
</li>
<li>
<p><code>客户端``服务端</code> PINGREQ 心跳请求和 PINGRESP 响应不能断。</p>
</li>
</ol>
<p><img alt="image.png" class="zoomable" loading="lazy" decoding="async" fetchpriority="auto" width="589" height="415" src="/_astro/net-img-1691546436311-4c3a2cef-bafb-4d1a-94bd-9bd7e7fddcc9-20231029145727-slz4jga.BLXgOrAj_muAb3.webp" ></p>
<h3 id="mqtt-发布消息">MQTT 发布消息<a class="anchor" href="#mqtt-发布消息">#</a></h3>
<blockquote>
<p>服务质量等级 QoS
<img alt="image.png" class="zoomable" loading="lazy" decoding="async" fetchpriority="auto" width="722" height="207" src="/_astro/net-img-1691546778230-eed2d192-57d4-48ca-a2d5-756307bd0031-20231029145727-vcpofwo.kDm702sj_Z1Omptu.webp" ></p>
</blockquote>
<h4 id="qos0-的-publish-控制报文">QoS0 的 PUBLISH 控制报文<a class="anchor" href="#qos0-的-publish-控制报文">#</a></h4>
<blockquote>
<p>发布消息服务器不会发送响应，发布者也不会重试，发出消息就丢弃了，所以消息可能根本没到达。
<strong>发布者必须发送 QoS 等于 0，DUP 等于 0 的 PUBLISH 报文。</strong></p>
</blockquote>
<ul>
<li>PUBLISH	发布消息 <code>发布者</code></li>
</ul>
<p><img alt="image.png" class="zoomable" loading="lazy" decoding="async" fetchpriority="auto" width="684" height="278" src="/_astro/net-img-1691547146156-35889a66-05a4-4bb0-80de-feecb3d48a8e-20231029145727-60ar2kv.CPBmW0aD_1ixqty.webp" ></p>
<h4 id="qos1-的-publish-控制报文">QoS1 的 PUBLISH 控制报文<a class="anchor" href="#qos1-的-publish-控制报文">#</a></h4>
<blockquote>
<p>确保消息至少送达一次，甚至可能被多次处理。QoS1 的 PUBLISH 报文的可变报头中包含一个报文标识符，需要 PUBACK 报文确认。
收到确认报文后丢弃消息。
<strong>发布者必须发送 QoS 等于 1，DUP 等于 0 的 PUBLISH 报文。</strong></p>
</blockquote>
<ul>
<li>PUBLISH	发布消息 <code>发布者</code></li>
<li>PUBACK	发布确认 <code>服务端</code></li>
</ul>
<p><img alt="image.png" class="zoomable" loading="lazy" decoding="async" fetchpriority="auto" width="669" height="281" src="/_astro/net-img-1691547822026-5c055992-f42e-452b-aa6d-3c89ff789f5c-20231029145727-9tvvm4i.C1GEB-QR_ZvrCju.webp" ></p>
<h4 id="qos2-的-publish-控制报文">QoS2 的 PUBLISH 控制报文<a class="anchor" href="#qos2-的-publish-控制报文">#</a></h4>
<blockquote>
<p>这是最高等级的服务质量，消息丢失和重复都是不可接受的。使用这个服务质量等级会有额外的开销。
<strong>发布者必须发送 QoS 等于 2，DUP 等于 0 的 PUBLISH 报文。</strong></p>
</blockquote>
<ul>
<li>PUBLISH		发布消息 <code>发布者</code></li>
<li>PUBREC		发布收到 <code>服务端</code></li>
<li>PUBREL 		发布释放 <code>发布者</code></li>
<li>PUBCOMP	发布完成 <code>服务端</code></li>
</ul>
<p><img alt="image.png" class="zoomable" loading="lazy" decoding="async" fetchpriority="auto" width="963" height="532" src="/_astro/net-img-1691547967451-104f0fb7-4d5e-4e8d-bb1e-2ba5c90cbd90-20231029145727-5sd863v.DASXtTJQ_ZMdy5o.webp" ></p>
<h3 id="取消订阅">取消订阅<a class="anchor" href="#取消订阅">#</a></h3>
<blockquote>
<p>UNSUBSCRIBE 报文固定报头的第 3,2,1,0 位是保留位且必须分别设置为 0,0,1,0。否则服务器必须认为任何其它的值都是不合法的并关闭网络连。具体的描述可以看协议文档。
UNSUBSCRIBE 报文的有效载荷包含客户端想要取消订阅的主题过滤器列表。UNSUBSCRIBE 报文中的主题过滤器必须是连续打包的 UTF-8 编码字符串。</p>
</blockquote>
<ul>
<li>UNSUBSCRIBE		取消订阅主题 <code>订阅者</code></li>
<li>UNSUBACK		取消订阅确认 <code>服务器</code></li>
</ul>
<p><img alt="image.png" class="zoomable" loading="lazy" decoding="async" fetchpriority="auto" width="624" height="442" src="/_astro/net-img-1691548269363-a3489452-d419-4e2c-a4a9-54f82973ef3c-20231029145727-1dxkhae.Df9EUS9-_2jWEvp.webp" ></p>
<h3 id="断开连接">断开连接<a class="anchor" href="#断开连接">#</a></h3>
<blockquote>
<p>DISCONNECT 报文是客户端发给服务端的最后一个控制报文。表示客户端正常断开连接。
DISCONNECT 报文的固定报头保留位必须全为 0。
客户端发送 DISCONNECT 报文之后必须关闭网络连接，不能通过那个网络连接再发送任何控制报文。</p>
</blockquote>
<ul>
<li><code>订阅者</code> DISCONNECT		断开连接</li>
</ul>
<h2 id="报文案例">报文案例<a class="anchor" href="#报文案例">#</a></h2>
<blockquote>
<p>这里按照数据报文的规定，给了每个报文的例子。
当然实际使用要转化为 ASCII 的十六进制码。</p>
</blockquote>
<h3 id="connect-连接服务端">CONNECT-连接服务端<a class="anchor" href="#connect-连接服务端">#</a></h3>
<blockquote>
<p>10 + 剩余的长度 + 00 04(协议名长度) + 4d 51 54 54(MQTT) + 04(协议版本) + 连接标志 + 00 3c(心跳间隔) + 客户端 ID 长度 2 字节 + 客户端 ID + 用户名长度 2 字节 + 用户名 + 密码长度 2 字节 + 密码</p>
</blockquote>
<p>这里有效载荷顺序必须是：客户端标识符，遗嘱主题，遗嘱消息，用户名，密码。
载荷的东西就根据连接标志里面 1 定义，比如上面的例子是在连接标志里面定义了用户名和密码。
剩余长度字段使用一个变长度编码方案，对小于 128 的值它使用单字节编码。更大的值按下面的方式处理。低 7 位有效位用于编码数据，最高有效位用于指示是否有更多的字节。因此每个字节可以编码 128 个数值和一个_延续位（continuation bit）_。剩余长度字段最大 4 个字节。</p>
<blockquote>
<p><a href="https://blog.csdn.net/Mark_md/article/details/108196317" rel="nofollow noopener noreferrer" target="_blank">https://blog.csdn.net/Mark_md/article/details/108196317<span style="user-select:none"> ↗</span></a>
这个计算是要有点门道。
大概就是把数值转化为二进制，在进行拆分填入
<img alt="image.png" class="zoomable" loading="lazy" decoding="async" fetchpriority="auto" width="729" height="519" src="/_astro/net-img-1691656288102-3bad4ddc-b4ea-459a-98b7-2a50847adebd-20231029145727-hewkwk3.D8A5HkUC_Z2wXrBU.webp" ></p>
</blockquote>
<p><img alt="image.png" class="zoomable" loading="lazy" decoding="async" fetchpriority="auto" width="742" height="201" src="/_astro/net-img-1691650760371-5e8df062-c4e0-46f6-8d2a-e1616e253be2-20231029145727-bwdif9c.lT67_0QV_2hwg0q.webp" >
<img alt="image.png" class="zoomable" loading="lazy" decoding="async" fetchpriority="auto" width="625" height="226" src="/_astro/net-img-1691655817329-4de30835-4609-4445-8ef0-71478e591d04-20231029145727-1paksoy.4NFHAC8g_aR5uY.webp" ></p>
<h3 id="pingreq-心跳请求">PINGREQ-心跳请求<a class="anchor" href="#pingreq-心跳请求">#</a></h3>
<blockquote>
<p>固定报文:    C0 00</p>
</blockquote>
<p>这个要在 CONNECT 规定的保持连接 Keep Alive 的秒数之内发送心跳就行。</p>
<h3 id="disconnect-断开连接">DISCONNECT-断开连接<a class="anchor" href="#disconnect-断开连接">#</a></h3>
<blockquote>
<p>固定报文：E0 00</p>
</blockquote>
<h3 id="subscribe_订阅主题">SUBSCRIBE_订阅主题<a class="anchor" href="#subscribe_订阅主题">#</a></h3>
<blockquote>
<p>82(固定报头) + 剩余长度 + 可变报头 2 字节(相当于用户 ID，自定义) + Topic 长度两字节 + Topic + 服务等级(0->00，1->01)</p>
</blockquote>
<p>剩余长度 = 可变 + 负载。</p>
<blockquote>
<p>可变报头建议顺序增加从 0001 到 ffff。
这个是关键，相当于订阅设备自己的 ID，不要重复。</p>
</blockquote>
<h3 id="unsubscribe_取消订阅">UNSUBSCRIBE_取消订阅<a class="anchor" href="#unsubscribe_取消订阅">#</a></h3>
<blockquote>
<p>A2(固定报头) + 剩余长度 + 可变报头 2 字节(相当于用户 ID，自定义) + Topic 长度两字节 + Topic</p>
</blockquote>
<p>和订阅主题就差别在：</p>
<ul>
<li>固定报头改了报文类型</li>
<li>结尾没有服务等级。</li>
</ul>
<h3 id="publish_数据上报">PUBLISH_数据上报<a class="anchor" href="#publish_数据上报">#</a></h3>
<blockquote>
<p>30(MQTT 报文类型 +DUP+QoS-H+QoS-+RETAIN) + 剩余长度 + 发布的 Topic 名字长度两字节 + 发布 Topic + 载荷数据
上面的 30 中 QoS 等级为 0，等级为 1 是 32</p>
</blockquote>
<blockquote>
<p>例子：用阿里云在线调试发布的消息，很随便
30 9D 01 00 33 2F 73 79 73 2F 61 31 79 79 65 71 67 70 73 4B 6D 2F 6D 71 74 74 5F 66 78 2F 74 68 69 6E 67 2F 73 65 72 76 69 63 65 2F 70 72 6F 70 65 72 74 79 2F 73 65 74 7B 22 6D 65 74 68 6F 64 22 3A 22 74 68 69 6E 67 2E 73 65 72 76 69 63 65 2E 70 72 6F 70 65 72 74 79 2E 73 65 74 22 2C 22 69 64 22 3A 22 33 34 34 34 36 31 37 31 22 2C 22 70 61 72 61 6D 73 22 3A 7B 22 74 65 6D 70 22 3A 38 38 2C 22 68 75 6D 69 22 3A 37 37 7D 2C 22 76 65 72 73 69 6F 6E 22 3A 22 31 2E 30 2E 30 22 7D
例子去掉前面的 30 9D 01 00 33 的数据为：</p>
<ul>
<li>/sys/a1yyeqgpsKm/mqtt_fx/thing/service/property/set{“method”:“thing.service.property.set”,“id”:“34446171”,“params”:{“temp”:88,“humi”:77},“version”:“1.0.0”}</li>
</ul>
</blockquote>
<p>以下是针对阿里云：</p>
<ul>
<li>要有请求方法	method + Topic</li>
<li>设备唯一标识	id + 自定义 ID</li>
<li>业务属性参数	属性 1 + 参数，属性 2……</li>
<li>协议版本号	version + 版本号</li>
</ul>
<p>上面的 QoS 等级为 0，就是没有任何响应的。</p>
<p>如果要有响应，就把固定报头加上 QoS 等级 1，为 32，格式中还要在 Topic 后面加上报文标识符两个字节。</p>
<h2 id="阿里云">阿里云<a class="anchor" href="#阿里云">#</a></h2>
<blockquote>
<p>CSDN 的连接教程：<a href="https://blog.csdn.net/fang_dz999/article/details/112283742" rel="nofollow noopener noreferrer" target="_blank">https://blog.csdn.net/fang_dz999/article/details/112283742<span style="user-select:none"> ↗</span></a>
阿里云的帮助手册：<a href="https://help.aliyun.com/zh/iot/user-guide/device-properties-events-and-services?spm=a2c4g.11186623.0.0.598577e11gleH5" rel="nofollow noopener noreferrer" target="_blank">https://help.aliyun.com/zh/iot/user-guide/device-properties-events-and-services?spm=a2c4g.11186623.0.0.598577e11gleH5<span style="user-select:none"> ↗</span></a></p>
</blockquote>
<p>只支持 0 和 1 的服务等级。</p>
<p>a1yyeqgpsKm.iot-as-mqtt.cn-shanghai.aliyuncs.com :1883   主机地址</p>
<h3 id="参数以阿里手册为主">参数（以阿里手册为主）<a class="anchor" href="#参数以阿里手册为主">#</a></h3>
<p>首先设备三元组是这个：</p>
<p>{   “ProductKey”: “a1yyeqgpsKm”,   “DeviceName”: “mqtt_fx”,   “DeviceSecret”: “3c2aadd7af6447d45fa661cf6adf309f” }</p>
<p><img alt="image" class="zoomable" loading="lazy" decoding="async" fetchpriority="auto" width="431" height="176" src="/_astro/image-20231116094703-zs09gmb.DVtLkxLN_Z1WIly3.webp" ></p>
<ol>
<li>
<p>客户端 ID</p>
<ol>
<li>
<p>*|securemode=2,signmethod=hmacsha256|</p>
<ol>
<li>*表示设备名称，注意替换</li>
</ol>
</li>
</ol>
</li>
<li>
<p>客户端 ID</p>
<ol>
<li>产品名 + &#x26; + 设备的 ProductKey</li>
</ol>
</li>
<li>
<p>密码（明文格式可能会变，看看平台的说明）</p>
<ol>
<li>设计到加密协议：HmacSHA1</li>
<li>找一下加密网站，用 DeviceSecret 作为密钥进行明文加密：clientld+ 设备名 +deviceName+ 设备名 +productKey+ 设备的密钥</li>
</ol>
</li>
<li>
<p>地址      端口 1883</p>
<ol>
<li>
<p>*.iot-as-mqtt.cn-shanghai.aliyuncs.com</p>
<ol>
<li>*表示自己账号的 ProductKey，注意替换。</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="自己编写一波">自己编写一波<a class="anchor" href="#自己编写一波">#</a></h3>
<div class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="markdown"><pre><code><span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 服务器：a1yyeqgpsKm.iot-as-mqtt.cn-shanghai.aliyuncs.com</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> username_用户名：mqtt_fx&#x26;a1yyeqgpsKm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">下面这密码是加密过的</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> passwd：c86c95ef56cceaaa6a8334ef090d6d5c5fa07ca6eac25b0872806188adbad420</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> clientID_客户端ID：a1yyeqgpsKm.mqtt_fx|securemode=2,signmethod=hmacsha256,timestamp=1691648594041|</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 发布和订阅： /a1yyeqgpsKm/${deviceName}/user/STM32F103C8T6</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 属性上报：	thing.event.property.post</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 属性设置：	thing.service.property.set</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 设备发布topic：	/sys/a1yyeqgpsKm/mqtt_fx/thing/event/property/post</span></span>
<span class="line"><span style="color:#E36209;--shiki-dark:#FFAB70">-</span><span style="color:#24292E;--shiki-dark:#E1E4E8"> 测试发布的数据：{"method":"thing.event.property.post","id":"23123123","params":{"temp":63 ,"humi":36},"version":"1.0.0"}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold"># CONNECT 连接客户端</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">10 b2 01 00 04 4d 51 54 54 04 c2 00 3c 00 4f 61 31 79 79 65 71 67 70 73 4B 6D 2E 6D 71 74 74 5F 66 78 7C 73 65 63 75 72 65 6D 6F 64 65 3D 32 2C 73 69 67 6E 6D 65 74 68 6F 64 3D 68 6D 61 63 73 68 61 32 35 36 2C 74 69 6D 65 73 74 61 6D 70 3D 31 36 39 31 36 34 38 35 39 34 30 34 31 7C 00 13 6D 71 74 74 5F 66 78 26 61 31 79 79 65 71 67 70 73 4B 6D 00 40 63 38 36 63 39 35 65 66 35 36 63 63 65 61 61 61 36 61 38 33 33 34 65 66 30 39 30 64 36 64 35 63 35 66 61 30 37 63 61 36 65 61 63 32 35 62 30 38 37 32 38 30 36 31 38 38 61 64 62 61 64 34 32 30</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold"># CONNACK 确认连接请求</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">20 02 00 00</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold"># PINGREQ 心跳请求</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">C0 00</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">> 尾巴 00->连接接受  01->连接拒绝，不支持协议版本  02->连接拒绝，不合格的客户端标识符</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">> 03->连接拒绝，服务端不可用 04->连接拒绝,无效的用户名或密码 05->连接拒绝，未授权</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold"># PINGRESP 心跳响应</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">D0 00</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold"># DISCONNECT 断开连接</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">E0 00</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold"># SUBSCRIBE 订阅主题</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">82 38 00 0A 00 33 2F 73 79 73 2F 61 31 79 79 65 71 67 70 73 4B 6D 2F 6D 71 74 74 5F 66 78 2F 74 68 69 6E 67 2F 73 65 72 76 69 63 65 2F 70 72 6F 70 65 72 74 79 2F 73 65 74 00</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold"># SUBACK 订阅确认</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">90 03 00 0A 01</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">> 中间的 00 0A 是订阅主题的报文标识符，用来表示是回复给订阅主题的 00 0A 设备。</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">> 这里尾巴有的讲。 00->最大QoS 0.  01->成功，最大QoS1.  02->成功，最大QoS2. 80->失败。</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">> </span><span style="color:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold"># 阿里云比较特殊确认回复的全是01。 #</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold"># UNSUBSCRIBE 取消订阅</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">A2 37 00 0A 00 33 2F 73 79 73 2F 61 31 79 79 65 71 67 70 73 4B 6D 2F 6D 71 74 74 5F 66 78 2F 74 68 69 6E 67 2F 73 65 72 76 69 63 65 2F 70 72 6F 70 65 72 74 79 2F 73 65 74</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold"># UNSUBACK 取消订阅确认</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">B0 02 00 0A</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">> 00 0A 是订阅主题的报文标识符，用来表示是取消订阅主题的 00 0A 设备。</span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">> 02 剩余长度</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold"># PUBLISH 发布消息</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">30 9D 01 00 33 2F 73 79 73 2F 61 31 79 79 65 71 67 70 73 4B 6D 2F 6D 71 74 74 5F 66 78 2F 74 68 69 6E 67 2F 73 65 72 76 69 63 65 2F 70 72 6F 70 65 72 74 79 2F 73 65 74 7B 22 6D 65 74 68 6F 64 22 3A 22 74 68 69 6E 67 2E 73 65 72 76 69 63 65 2E 70 72 6F 70 65 72 74 79 2E 73 65 74 22 2C 22 69 64 22 3A 22 33 34 34 34 36 31 37 31 22 2C 22 70 61 72 61 6D 73 22 3A 7B 22 74 65 6D 70 22 3A 38 38 2C 22 68 75 6D 69 22 3A 37 37 7D 2C 22 76 65 72 73 69 6F 6E 22 3A 22 31 2E 30 2E 30 22 7D </span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">> 这里发布的是QoS为0的消息，没有确认</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;--shiki-light-font-weight:bold;--shiki-dark:#79B8FF;--shiki-dark-font-weight:bold"># PUBACK 发布确认</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">40 02 7B 22 </span></span>
<span class="line"><span style="color:#22863A;--shiki-dark:#85E89D">> 40 固定报头，02 为接下来剩余长度固定为2，7b 22 发布消息的报文标识符（标识符必须是2个字节）</span></span></code></pre><span class="language ps-1 pe-3 text-sm bg-muted text-muted-foreground">markdown</span><button class="copy text-muted-foreground p-1 box-content border rounded bg-primary-foreground" data-code="- 服务器：a1yyeqgpsKm.iot-as-mqtt.cn-shanghai.aliyuncs.com
- username_用户名：mqtt_fx&#x26;a1yyeqgpsKm

下面这密码是加密过的
- passwd：c86c95ef56cceaaa6a8334ef090d6d5c5fa07ca6eac25b0872806188adbad420
- clientID_客户端ID：a1yyeqgpsKm.mqtt_fx|securemode=2,signmethod=hmacsha256,timestamp=1691648594041|
- 发布和订阅： /a1yyeqgpsKm/${deviceName}/user/STM32F103C8T6

- 属性上报：	thing.event.property.post
- 属性设置：	thing.service.property.set
- 设备发布topic：	/sys/a1yyeqgpsKm/mqtt_fx/thing/event/property/post
- 测试发布的数据：{&#x22;method&#x22;:&#x22;thing.event.property.post&#x22;,&#x22;id&#x22;:&#x22;23123123&#x22;,&#x22;params&#x22;:{&#x22;temp&#x22;:63 ,&#x22;humi&#x22;:36},&#x22;version&#x22;:&#x22;1.0.0&#x22;}

# CONNECT 连接客户端
10 b2 01 00 04 4d 51 54 54 04 c2 00 3c 00 4f 61 31 79 79 65 71 67 70 73 4B 6D 2E 6D 71 74 74 5F 66 78 7C 73 65 63 75 72 65 6D 6F 64 65 3D 32 2C 73 69 67 6E 6D 65 74 68 6F 64 3D 68 6D 61 63 73 68 61 32 35 36 2C 74 69 6D 65 73 74 61 6D 70 3D 31 36 39 31 36 34 38 35 39 34 30 34 31 7C 00 13 6D 71 74 74 5F 66 78 26 61 31 79 79 65 71 67 70 73 4B 6D 00 40 63 38 36 63 39 35 65 66 35 36 63 63 65 61 61 61 36 61 38 33 33 34 65 66 30 39 30 64 36 64 35 63 35 66 61 30 37 63 61 36 65 61 63 32 35 62 30 38 37 32 38 30 36 31 38 38 61 64 62 61 64 34 32 30

# CONNACK 确认连接请求
20 02 00 00

# PINGREQ 心跳请求
C0 00
> 尾巴 00->连接接受  01->连接拒绝，不支持协议版本  02->连接拒绝，不合格的客户端标识符
> 03->连接拒绝，服务端不可用 04->连接拒绝,无效的用户名或密码 05->连接拒绝，未授权

# PINGRESP 心跳响应
D0 00

# DISCONNECT 断开连接
E0 00

# SUBSCRIBE 订阅主题
82 38 00 0A 00 33 2F 73 79 73 2F 61 31 79 79 65 71 67 70 73 4B 6D 2F 6D 71 74 74 5F 66 78 2F 74 68 69 6E 67 2F 73 65 72 76 69 63 65 2F 70 72 6F 70 65 72 74 79 2F 73 65 74 00

# SUBACK 订阅确认
90 03 00 0A 01
> 中间的 00 0A 是订阅主题的报文标识符，用来表示是回复给订阅主题的 00 0A 设备。
> 这里尾巴有的讲。 00->最大QoS 0.  01->成功，最大QoS1.  02->成功，最大QoS2. 80->失败。
> # 阿里云比较特殊确认回复的全是01。 #

# UNSUBSCRIBE 取消订阅
A2 37 00 0A 00 33 2F 73 79 73 2F 61 31 79 79 65 71 67 70 73 4B 6D 2F 6D 71 74 74 5F 66 78 2F 74 68 69 6E 67 2F 73 65 72 76 69 63 65 2F 70 72 6F 70 65 72 74 79 2F 73 65 74

# UNSUBACK 取消订阅确认
B0 02 00 0A
> 00 0A 是订阅主题的报文标识符，用来表示是取消订阅主题的 00 0A 设备。
> 02 剩余长度

# PUBLISH 发布消息
30 9D 01 00 33 2F 73 79 73 2F 61 31 79 79 65 71 67 70 73 4B 6D 2F 6D 71 74 74 5F 66 78 2F 74 68 69 6E 67 2F 73 65 72 76 69 63 65 2F 70 72 6F 70 65 72 74 79 2F 73 65 74 7B 22 6D 65 74 68 6F 64 22 3A 22 74 68 69 6E 67 2E 73 65 72 76 69 63 65 2E 70 72 6F 70 65 72 74 79 2E 73 65 74 22 2C 22 69 64 22 3A 22 33 34 34 34 36 31 37 31 22 2C 22 70 61 72 61 6D 73 22 3A 7B 22 74 65 6D 70 22 3A 38 38 2C 22 68 75 6D 69 22 3A 37 37 7D 2C 22 76 65 72 73 69 6F 6E 22 3A 22 31 2E 30 2E 30 22 7D 
> 这里发布的是QoS为0的消息，没有确认

# PUBACK 发布确认
40 02 7B 22 
> 40 固定报头，02 为接下来剩余长度固定为2，7b 22 发布消息的报文标识符（标识符必须是2个字节）" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 2000)
        "><div class="ready"><svg class="size-5"><use href="/icons/code.svg#mingcute-clipboard-line"></use></svg></div><div class="success hidden"><svg class="size-5"><use href="/icons/code.svg#mingcute-file-check-line"></use></svg></div></button></div>
<h3 id="上传格式">上传格式<a class="anchor" href="#上传格式">#</a></h3>
<p>上传格式：</p>
<ul>
<li>id：String\每个设备的唯一 ID，自定义。</li>
<li>params：Object\请求业务的参数，里面是一些属性和数值。</li>
<li>version：String\协议版本号，目前协议版本号唯一值为 <code>1.0</code>。</li>
<li>method：String\请求方法。
<ul>
<li>发布属性：thing.event.property.post</li>
</ul>
</li>
</ul>
<div class="astro-code astro-code-themes github-light github-dark" style="background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="json"><pre><code><span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">{</span><span style="color:#005CC5;--shiki-dark:#79B8FF">"id"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">自定义设备唯一ID</span><span style="color:#24292E;--shiki-dark:#E1E4E8">, </span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">	"params"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:{</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">		"物模型属性名1"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">数据</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">		"物模型属性名2"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic">数据</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">	},</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">	"version"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"1.0"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="color:#005CC5;--shiki-dark:#79B8FF">	"method"</span><span style="color:#24292E;--shiki-dark:#E1E4E8">:</span><span style="color:#032F62;--shiki-dark:#9ECBFF">"thing.event.property.post"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><span class="language ps-1 pe-3 text-sm bg-muted text-muted-foreground">json</span><button class="copy text-muted-foreground p-1 box-content border rounded bg-primary-foreground" data-code="{&#x22;id&#x22;:自定义设备唯一ID, 
	&#x22;params&#x22;:{
		&#x22;物模型属性名1&#x22;:数据,
		&#x22;物模型属性名2&#x22;:数据
	},
	&#x22;version&#x22;:&#x22;1.0&#x22;,
	&#x22;method&#x22;:&#x22;thing.event.property.post&#x22;
}" onclick="
          navigator.clipboard.writeText(this.dataset.code);
          this.classList.add(&#x27;copied&#x27;);
          setTimeout(() => this.classList.remove(&#x27;copied&#x27;), 2000)
        "><div class="ready"><svg class="size-5"><use href="/icons/code.svg#mingcute-clipboard-line"></use></svg></div><div class="success hidden"><svg class="size-5"><use href="/icons/code.svg#mingcute-file-check-line"></use></svg></div></button></div>
<p>‍</p>  <aside aria-label="TIP" class="aside my-3 overflow-hidden rounded-xl border astro-kdde4gve"> <div class="aside-container border-l-8 border-primary px-4 py-3 bg-primary aside-tip astro-kdde4gve"> <p class="not-prose flex items-center gap-x-2 font-medium text-primary astro-kdde4gve" aria-hidden="true"> <svg aria-hidden="true" class="astro-kdde4gve astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M13 20a1 1 0 1 1 0 2h-2a1 1 0 1 1 0-2zM12 2c4.41 0 8 3.543 8 7.933c0 3.006-1.522 5.196-2.78 6.494l-.284.283l-.27.252l-.252.22l-.33.27l-.328.244c-.196.138-.34.329-.466.535l-.145.251l-.141.252c-.24.412-.518.766-1.111.766h-3.786c-.593 0-.871-.354-1.11-.766l-.213-.378c-.145-.253-.305-.494-.54-.66l-.232-.171l-.199-.155l-.227-.188l-.252-.22l-.27-.252l-.285-.283C5.522 15.129 4 12.939 4 9.933C4 5.543 7.59 2 12 2m0 2C8.677 4 6 6.665 6 9.933c0 2.624 1.533 4.494 2.593 5.471l.245.218l.22.182l.27.208l.072.052c.315.222.549.531.762.854l.373.582h2.93l.373-.582c.213-.323.447-.632.762-.854l.243-.182l.206-.165l.233-.2C16.342 14.576 18 12.662 18 9.933C18 6.665 15.323 4 12 4m.293 2.293a1 1 0 0 1 1.497 1.32l-.083.094L12.414 9l1.286 1.286c.364.364.392.937.084 1.333l-.084.095l-1.993 1.993a1 1 0 0 1-1.497-1.32l.083-.094L11.586 11L10.3 9.714a1.01 1.01 0 0 1-.084-1.333l.084-.095z"/></g></svg>  TIP </p> <div class="aside-content mt-2 astro-kdde4gve"> 
本文章为原创内容，非AI生成。如需转载或引用，请注明出处并遵守相关CC许可协议。
    感谢同仁们对原创内容的支持与尊重！
 </div> </div> </aside>     </div> </article> </main> <div class="bottom mt-6 items-start gap-x-10 md:flex astro-scuu7fyy">  <div class="flex-1 text-muted-foreground md:min-w-[50ch] astro-scuu7fyy"> <div class="relative flex flex-col gap-y-2 rounded-xl border px-3 sm:px-4 py-2 sm:py-3 astro-sjxyoaq4"> <svg aria-hidden="true" class="absolute end-4 top-4 size-20 opacity-10 astro-sjxyoaq4 astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2m0 2a8 8 0 1 0 0 16a8 8 0 0 0 0-16m0 3a5 5 0 0 1 3.75 1.692a1 1 0 1 1-1.5 1.324a3 3 0 1 0 0 3.968a1 1 0 1 1 1.5 1.324A5 5 0 1 1 12 7"/></g></svg>   <div class="flex flex-col astro-sjxyoaq4"> <div class="font-medium text-foreground astro-sjxyoaq4">MQTT协议全面解析</div> <div class="text-sm astro-sjxyoaq4">https://poetrycld.com/blog/2025/2511-mqttprotocolanalysis</div> </div>  <div class="flex flex-row flex-wrap justify-start gap-x-5 gap-y-1 sm:gap-x-8 astro-sjxyoaq4"> <div class="flex gap-x-2 sm:flex-col astro-sjxyoaq4"> <span class="astro-sjxyoaq4">Author</span> <span class="text-sm text-foreground max-sm:place-self-center astro-sjxyoaq4">PoetryCloud</span> </div> <div class="flex gap-x-2 sm:min-w-16 sm:flex-col astro-sjxyoaq4"> <span class="astro-sjxyoaq4">Published at</span> <span class="text-sm text-foreground max-sm:place-self-center astro-sjxyoaq4"> November 28, 2025 </span> </div> <div class="flex gap-x-2 sm:flex-col astro-sjxyoaq4"> <span class="astro-sjxyoaq4">Copyright</span> <a class="text-sm text-foreground max-sm:place-self-center astro-sjxyoaq4" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">
CC BY-NC-SA 4.0
</a> </div> </div>  <div class="relative astro-sjxyoaq4"> <div class="flex flex-row gap-3 astro-sjxyoaq4"> <button id="copy-link" class="group rounded-full bg-muted p-1 text-muted-foreground transition-colors hover:text-primary sm:p-1.5 astro-sjxyoaq4"> <svg aria-hidden="true" class="size-5 astro-sjxyoaq4 astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M16.243 9.878a1 1 0 0 1 1.32-.083l.094.083L19.778 12a5.5 5.5 0 0 1-7.596 7.952L12 19.778l-2.121-2.121a1 1 0 0 1 1.32-1.498l.094.083l2.121 2.122a3.5 3.5 0 0 0 5.091-4.8l-.141-.15l-2.121-2.121a1 1 0 0 1 0-1.415M9.17 9.171a1 1 0 0 1 1.32-.083l.095.083l4.242 4.243a1 1 0 0 1-1.32 1.497l-.094-.083l-4.243-4.242a1 1 0 0 1 0-1.415m-4.95-4.95a5.5 5.5 0 0 1 7.597-.173l.182.174l2.121 2.12A1 1 0 0 1 12.8 7.84l-.094-.083l-2.121-2.121a3.5 3.5 0 0 0-5.091 4.8l.141.15l2.121 2.12a1 1 0 0 1-1.32 1.498l-.094-.083L4.222 12a5.5 5.5 0 0 1 0-7.778Z"/></g></svg>  </button> <button id="get-qrcode" class="group rounded-full bg-muted p-1 text-muted-foreground transition-colors hover:text-primary sm:p-1.5 astro-sjxyoaq4"> <svg aria-hidden="true" class="size-5 astro-sjxyoaq4 astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M11 3a2 2 0 0 1 1.995 1.85L13 5v6a2 2 0 0 1-1.85 1.995L11 13H5a2 2 0 0 1-1.995-1.85L3 11V5a2 2 0 0 1 1.85-1.995L5 3zm0 2H5v6h6zM8.5 7a.5.5 0 0 1 .492.41L9 7.5v1a.5.5 0 0 1-.41.492L8.5 9h-1a.5.5 0 0 1-.492-.41L7 8.5v-1a.5.5 0 0 1 .41-.492L7.5 7zM21 5a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2zm-4 0h2v2h-2zM7 15a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2zm0 2H5v2h2zm14 0a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2zm-4 0h2v2h-2zm-2-5a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1m-2 4a1 1 0 1 0-2 0v4a1 1 0 1 0 2 0z"/></g></svg>  </button> <a href="http://service.weibo.com/share/share.php?url=https://poetrycld.com/blog/2025/2511-mqttprotocolanalysis&title=MQTT协议全面解析&pic=/_astro/2512-MqttProtocolAnalysis-banner.BU97JBLf.jpg" target="_blank" id="share-weibo" class="group rounded-full bg-muted p-1 text-muted-foreground transition-colors hover:text-primary sm:p-1.5 astro-sjxyoaq4"> <svg aria-hidden="true" class="size-5 astro-sjxyoaq4 astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M13.12 5.815c.55.537.826 1.24.863 1.992c1.675-.502 3.045-.362 3.937.5c.848.82.937 1.967.617 2.964C19.9 11.961 21 13.058 21 14.715c0 1.93-1.256 3.526-2.962 4.586C16.318 20.371 14.004 21 11.5 21s-4.818-.63-6.538-1.699C3.256 18.241 2 16.646 2 14.715c0-1.762.842-3.589 2.05-5.156a14.6 14.6 0 0 1 4.723-3.954c1.635-.847 3.286-.828 4.347.21m-1.399 1.43c-.213-.21-.829-.485-2.028.136a12.6 12.6 0 0 0-4.06 3.4C4.576 12.154 4 13.558 4 14.715c0 .988.647 2.035 2.018 2.888C7.374 18.446 9.309 19 11.5 19c2.19 0 4.127-.554 5.482-1.397c1.371-.853 2.018-1.9 2.018-2.888c0-.711-.56-1.439-2.16-1.991a1 1 0 0 1-.473-1.546c.495-.66.355-1.248.163-1.433l-.048-.04l-.067-.042c-.337-.186-1.274-.368-3.335.661a1 1 0 0 1-1.347-1.33c.444-.92.225-1.517-.012-1.75ZM17 3c1.576 0 3.128.643 4.243 1.757A6.05 6.05 0 0 1 23 9a1 1 0 1 1-2 0c0-1.05-.429-2.086-1.172-2.828A4.04 4.04 0 0 0 17 5a1 1 0 1 1 0-2"/></g></svg>  </a><a href="https://x.com/intent/tweet?text='MQTT协议全面解析'&url='https://poetrycld.com/blog/2025/2511-mqttprotocolanalysis'&via='PoetryCloud'" target="_blank" id="share-x" class="group rounded-full bg-muted p-1 text-muted-foreground transition-colors hover:text-primary sm:p-1.5 astro-sjxyoaq4"> <svg aria-hidden="true" class="size-5 astro-sjxyoaq4 astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M19.753 4.659a1 1 0 0 0-1.506-1.317l-5.11 5.84L8.8 3.4A1 1 0 0 0 8 3H4a1 1 0 0 0-.8 1.6l6.437 8.582l-5.39 6.16a1 1 0 0 0 1.506 1.317l5.11-5.841L15.2 20.6a1 1 0 0 0 .8.4h4a1 1 0 0 0 .8-1.6l-6.437-8.582l5.39-6.16ZM16.5 19L6 5h1.5L18 19z"/></g></svg>  </a><a href="https://bsky.app/intent/compose?text=MQTT协议全面解析%0Ahttps://poetrycld.com/blog/2025/2511-mqttprotocolanalysis" target="_blank" id="share-bluesky" class="group rounded-full bg-muted p-1 text-muted-foreground transition-colors hover:text-primary sm:p-1.5 astro-sjxyoaq4"> <svg aria-hidden="true" class="size-5 astro-sjxyoaq4 astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none" fill-rule="evenodd"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M4.747 5.105a.94.94 0 0 0-.41.892l.314 3.287A3 3 0 0 0 7.637 12H9a1 1 0 0 1 .371 1.928l-2.34.937c-.885.354-1.122 1.32-.664 1.932c.288.384.576.731.84.996c.233.233.532.485.865.74c.619.475 1.625.214 1.94-.734l1.04-3.115a1 1 0 0 1 1.897 0l1.038 3.115c.316.948 1.322 1.21 1.941.735a9 9 0 0 0 .865-.741c.265-.265.553-.612.84-.996c.458-.612.222-1.578-.664-1.932l-2.34-.937A1 1 0 0 1 15 12h1.363a3 3 0 0 0 2.986-2.716l.314-3.287a.94.94 0 0 0-.41-.892a.75.75 0 0 0-.858-.001c-2.645 1.708-4.05 3.442-5.5 6.343a1 1 0 0 1-1.79 0c-1.45-2.901-2.855-4.635-5.5-6.343a.75.75 0 0 0-.858.001m-2.4 1.082C2.13 3.913 4.567 2.053 6.69 3.424C9.13 5 10.662 6.639 12 8.9c1.338-2.261 2.87-3.9 5.31-5.476c2.123-1.371 4.56.49 4.344 2.763l-.314 3.287a5 5 0 0 1-2.783 4.02c1.329 1.039 1.818 2.978.677 4.502c-.317.423-.669.853-1.027 1.211c-.317.317-.69.628-1.062.914c-1.88 1.441-4.375.35-5.055-1.69l-.09-.269l-.09.27c-.68 2.04-3.175 3.13-5.055 1.689a11 11 0 0 1-1.062-.914a11.5 11.5 0 0 1-1.027-1.211c-1.141-1.524-.651-3.463.678-4.502a5 5 0 0 1-2.784-4.02z"/></g></svg>  </a> </div> <div id="qrcode-container" class="absolute z-10 -mt-2 box-content max-h-0 max-w-44 overflow-hidden rounded-xl border bg-muted p-4 opacity-0 transition-all duration-300 ease-in-out astro-sjxyoaq4"></div> <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script> <script>(function(){const content = undefined;

  const renderContent = content ?? window.location.href
  // Load qrcode
  function loadQRcode(qrcodeContainer) {
    if (!qrcodeContainer) throw new Error('qrcode container not found')
    if (qrcodeContainer.innerHTML !== '') return
    new QRCode(qrcodeContainer, renderContent)
  }
  const qrcodeContainer = document.getElementById('qrcode-container')
  if (!qrcodeContainer) throw new Error('qrcode container not found')
  loadQRcode(qrcodeContainer)
})();</script> </div> </div> <div class="mx-6 rounded-b-xl border border-t-0 px-3 pb-1.5 pt-1 sm:mx-8 sm:px-4 astro-sjxyoaq4"> <a href="/projects#sponsorship" class="flex items-center justify-between text-muted-foreground no-underline astro-sjxyoaq4" target="_blank"> <span class="astro-sjxyoaq4">Buy me a cup of coffee ☕.</span> <svg aria-hidden="true" class="box-content size-5 p-1 astro-sjxyoaq4 astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M17 2a3 3 0 0 1 3 3v12a1 1 0 0 1 .351 1.936l-8 3a1 1 0 0 1-.702 0l-8-3A1 1 0 0 1 4 17V5a3 3 0 0 1 3-3zm0 2H7a1 1 0 0 0-.993.883L6 5v12.682l6 2.25l6-2.25V5a1 1 0 0 0-.883-.993zm-5 1a1 1 0 0 1 .993.883L13 6v1h2a1 1 0 0 1 .117 1.993L15 9h-5a.5.5 0 0 0-.09.992L10 10h4a2.5 2.5 0 0 1 .164 4.995L14 15h-1v1a1 1 0 0 1-1.993.117L11 16v-1H9a1 1 0 0 1-.117-1.993L9 13h5a.5.5 0 0 0 .09-.992L14 12h-4a2.5 2.5 0 0 1-.164-4.995L10 7h1V6a1 1 0 0 1 1-1"/></g></svg>  </a> </div>  <script type="module" src="/_astro/Copyright.astro_astro_type_script_index_0_lang.B_VQDGfL.js"></script> <div class="flex max-sm:flex-col sm:justify-between gap-2 mt-3 sm:mt-6"> <span class="min-w-0"> <a href="/blog/2025/2512-tlsprocessanalysismd" class="group inline-flex items-center gap-x-2 rounded-xl px-4 py-2 no-underline transition-colors duration-300 hover:bg-muted max-sm:max-w-[80%] sm:flex"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="shrink-0 rotate-180 stroke-muted-foreground transition-colors group-hover:stroke-primary"> <line x1="5" y1="12" x2="19" y2="12" class="translate-x-4 scale-x-0 transition-all duration-300 ease-in-out group-hover:translate-x-1 group-hover:scale-x-100"></line> <polyline points="12 5 19 12 12 19" class="translate-x-0 transition-all duration-300 ease-in-out group-hover:translate-x-1"></polyline> </svg> <p class="truncate font-medium transition-colors">TLS协议流程解析</p> </a> </span> <span class="min-w-0">  </span> </div>  <!-- <script src="https://giscus.app/client.js"
        data-repo="Ye-YunXiang/Ye-YunXiang.github.io"
        data-repo-id="R_kgDOQYM5gQ"
        data-category="Announcements"
        data-category-id="DIC_kwDOQYM5gc4CyAkg"
        data-mapping="title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        data-theme="preferred_color_scheme"
        async>
</script> --><!-- <section class="giscus mx-auto mt-10 w-full"></section> --><div id="giscus-container"></div> <script>(function(){const repo = "Ye-YunXiang/Ye-YunXiang.github.io";
const repoId = "R_kgDOQYM5gQ";
const category = "Announcements";
const categoryId = "DIC_kwDOQYM5gc4CyAkg";
const mapping = "pathname";
const reactionsEnabled = true;
const emitMetadata = false;
const inputPosition = "top";
const lang = "zh-CN";

  function loadGiscus() {
    const container = document.getElementById('giscus-container');
    if (!container) return;

    // 获取当前主题
    const isDark = document.documentElement.classList.contains('dark');
    const theme = isDark ? 'dark' : 'light';

    // 创建Giscus脚本
    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';
    script.setAttribute('data-repo', repo);
    script.setAttribute('data-repo-id', repoId);
    script.setAttribute('data-category', category);
    script.setAttribute('data-category-id', categoryId);
    script.setAttribute('data-mapping', mapping);
    script.setAttribute('data-strict', '0');
    script.setAttribute('data-reactions-enabled', reactionsEnabled ? '1' : '0');
    script.setAttribute('data-emit-metadata', emitMetadata ? '1' : '0');
    script.setAttribute('data-input-position', inputPosition);
    script.setAttribute('data-theme', theme);
    script.setAttribute('data-lang', lang);
    script.setAttribute('data-loading', 'lazy');
    script.crossOrigin = 'anonymous';
    script.async = true;

    container.appendChild(script);
  }

  // 监听主题变化
  function updateGiscusTheme() {
    const giscusFrame = document.querySelector('iframe[src*="giscus"]');
    if (giscusFrame) {
      const isDark = document.documentElement.classList.contains('dark');
      const theme = isDark ? 'dark' : 'light';

      giscusFrame.contentWindow.postMessage({
        giscus: {
          setConfig: {
            theme: theme
          }
        }
      }, 'https://giscus.app');
    }
  }

  // 监听DOM变化来检测主题切换
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
        updateGiscusTheme();
      }
    });
  });

  // 页面加载时初始化
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadGiscus);
  } else {
    loadGiscus();
  }

  // 开始观察主题变化
  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['class']
  });
})();</script> </div> <div class="min-w-48 basis-60 astro-scuu7fyy">  </div> </div> <div class="z-10 group fixed bottom-8 end-4 transition-all flex flex-col gap-y-4 sm:end-8 astro-jxfdehre" id="action-buttons"> <button aria-label="Toggle sidebar" class="size-10 flex items-center justify-center rounded-full border-2 border-transparent bg-muted text-muted-foreground duration-300 hover:border-border/75 md:hidden sm:size-12 astro-scuu7fyy" id="sidebar-btn"> <svg aria-hidden="true" class="astro-scuu7fyy astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M4.5 17.5a1.5 1.5 0 1 1 0 3a1.5 1.5 0 0 1 0-3M20 18a1 1 0 1 1 0 2H9a1 1 0 1 1 0-2zM4.5 10.5a1.5 1.5 0 1 1 0 3a1.5 1.5 0 0 1 0-3M20 11a1 1 0 0 1 .117 1.993L20 13H9a1 1 0 0 1-.117-1.993L9 11zM4.5 3.5a1.5 1.5 0 1 1 0 3a1.5 1.5 0 0 1 0-3M20 4a1 1 0 0 1 .117 1.993L20 6H9a1 1 0 0 1-.117-1.993L9 4z"/></g></svg>  </button> <button aria-label="Back to Top" class="relative size-10 flex items-center justify-center rounded-full border-2 border-transparent bg-muted text-muted-foreground duration-300 hover:border-border/75 sm:size-12 opacity-0 astro-jxfdehre" id="to-top-btn"> <div class="top-text absolute bottom-0 end-0 start-0 top-0 flex items-center justify-center group-[.ended]:opacity-0 astro-jxfdehre"> <span class="text astro-jxfdehre">10</span> <span class="text-xs astro-jxfdehre">%</span> </div> <svg aria-hidden="true" class="top-icon group-[.ended]:opacity-100 astro-jxfdehre astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none" fill-rule="evenodd"><path d="M24 0v24H0V0zM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M11.293 8.293a1 1 0 0 1 1.414 0l5.657 5.657a1 1 0 0 1-1.414 1.414L12 10.414l-4.95 4.95a1 1 0 0 1-1.414-1.414z"/></g></svg>  </button> </div> <script>(function(){const headerName = "content-header";
const contentName = "content";
const needPercent = true;

  const actionBtns = document.getElementById('action-buttons')
  const scrollBtn = document.getElementById('to-top-btn')
  const scrollPercentEl = scrollBtn.children[0].children[0]
  const targetHeader = document.getElementById(headerName)
  const articleElement = document.getElementById(contentName)

  // scroll to top
  function callback(entries) {
    entries.forEach((entry) => {
      // only show the action buttons when the heading is out of view
      actionBtns.classList.toggle('show', !entry.isIntersecting)
    })
  }
  scrollBtn.addEventListener('click', () => {
    document.documentElement.scrollTo({ behavior: 'smooth', top: 0 })
  })
  if (targetHeader) {
    const observer = new IntersectionObserver(callback)
    observer.observe(targetHeader)
  } else {
    console.error(`Element with ID ${headerName} not found.`)
  }
  if (needPercent) {
    // scroll percentage
    const scrollHeight = articleElement.scrollHeight // total height
    const articleTop = articleElement.offsetTop // article top
    const clientHeight = document.documentElement.clientHeight // client height

    function calculateScrollPercent() {
      const scrollTop = document.documentElement.scrollTop || document.body.scrollTop
      if (scrollTop < articleTop) return
      return Math.round(((scrollTop - articleTop) / (scrollHeight - clientHeight)) * 100)
    }

    document.addEventListener('scroll', () => {
      const scrollPercent = calculateScrollPercent()
      if (scrollPercent === undefined) return
      scrollPercentEl.innerText = scrollPercent.toString()

      // If percent is 100, percent won't need to show
      actionBtns.classList.toggle('ended', scrollPercent > 100)
    })
  } else {
    actionBtns.classList.add('ended')
  }
})();</script>   </div> <footer class="mx-auto mb-5 mt-16 w-full"> <div class="border-t pt-5"> <div class="flex items-center gap-y-3 max-sm:flex-col sm:justify-between sm:gap-y-0"> <div class="flex items-center gap-x-4 gap-y-2 text-muted-foreground max-sm:flex-col [&_a]:text-foreground">  <div> <span> <a href="https://creativecommons.org/licenses/by/4.0/deed.zh-hans" target="_blank" class="text-sm"> Copyright </a>  •  </span><span> <a href="https://www.travellings.cn/go.html" target="_blank" class="text-sm"> Travelling </a>  </span> </div>  <div> © 2025 - 2025 PoetryCloud 
&
<span> <span> <a href="/terms/list" target="_blank"> Site Policy </a> </span> </span>  </div> <span> <a href="https://github.com/withastro/astro" target="_blank">
Astro
</a>
&
<a href="https://github.com/cworld1/astro-theme-pure" target="_blank">
Pure
</a>
theme powered
</span> </div>  <div class="flex items-center gap-x-4"> <a class="inline-block text-muted-foreground transition-all hover:text-muted-foreground/75" href="/rss.xml" aria-label="RSS"> <svg aria-hidden="true" class=" astro-hn7k2gay" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><g fill="none"><path d="m12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.019-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M5.5 17a1.5 1.5 0 1 1 0 3a1.5 1.5 0 0 1 0-3m0-14C14.06 3 21 9.94 21 18.5q0 .268-.009.534a1 1 0 0 1-1.999-.068Q19 18.734 19 18.5C19 11.044 12.956 5 5.5 5q-.234 0-.466.008a1 1 0 0 1-.068-1.999Q5.231 3 5.5 3m0 7a8.5 8.5 0 0 1 8.482 9.066a1 1 0 0 1-1.996-.132a6.5 6.5 0 0 0-6.92-6.92a1 1 0 1 1-.132-1.995q.28-.02.566-.019"/></g></svg>  </a> </div> </div> </div> </footer> </div>   </body> </html> <script type="module">const d=document.getElementById("sidebar-btn"),e=document.getElementById("sidebar"),s=document.getElementById("sidebar-shade");s&&s.addEventListener("click",()=>{t()});function t(){e&&e.classList.contains("show")?(e.classList.remove("show"),s.style.display="none"):e&&(e.classList.add("show"),s.style.display="block")}d?.addEventListener("click",()=>{t()});</script>  <script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/pure/medium-zoom.min.umd.js"></script> <script>(function(){const selector = ".prose .zoomable";
const background = "hsl(var(--background) / 0.8)";

  mediumZoom(selector, { background })
})();</script> 